<!-- src/routes/admin/dashboard/+page.svelte -->
<script lang="ts">
  import { onMount } from 'svelte';
  import AdminLayout from '$lib/components/admin/AdminLayout.svelte';
  import { categoryApi, productApi } from '$lib/admin/api';
  
  let stats = $state({
    totalCategories: 0,
    totalProducts: 0,
    activeProducts: 0,
    inactiveProducts: 0
  });
  
  let isLoading = $state(true);
  let error = $state('');
  
  onMount(async () => {
    await loadStats();
  });
  
  async function loadStats() {
    try {
      isLoading = true;
      error = '';
      
      const [categoriesResult, productsResult] = await Promise.all([
        categoryApi.getAll(),
        productApi.getAll()
      ]);
      
      if (categoriesResult.success && productsResult.success) {
        const categories = (categoriesResult.data as any)?.categories || [];
        const products = (productsResult.data as any)?.products || [];
        
        stats = {
          totalCategories: categories.length,
          totalProducts: products.length,
          activeProducts: products.filter((p: any) => p.isAvailable).length,
          inactiveProducts: products.filter((p: any) => !p.isAvailable).length
        };
      } else {
        error = 'Erro ao carregar estatísticas';
      }
    } catch (err) {
      console.error('Error loading stats:', err);
      error = 'Erro inesperado ao carregar dados';
    } finally {
      isLoading = false;
    }
  }
</script>

<AdminLayout title="Dashboard">
  <!-- Welcome Section -->\n  <div class=\"mb-8\">\n    <div class=\"bg-gradient-to-r from-amber-500 to-orange-500 rounded-2xl p-8 text-white\">\n      <div class=\"flex items-center justify-between\">\n        <div>\n          <h2 class=\"text-3xl font-bold mb-2\">Bem-vindo ao Admin Panel!</h2>\n          <p class=\"text-amber-100 text-lg\">Gerencie sua padaria de forma fácil e eficiente</p>\n        </div>\n        <div class=\"hidden md:block\">\n          <svg class=\"w-24 h-24 text-amber-200/30\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n            <path d=\"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z\"/>\n          </svg>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  <!-- Statistics Cards -->\n  <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n    <!-- Total Categories -->\n    <div class=\"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow\">\n      <div class=\"flex items-center\">\n        <div class=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4\">\n          <svg class=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14-4v8a2 2 0 01-2 2H7a2 2 0 01-2-2V7a2 2 0 012-2h10a2 2 0 012 2zM9 11h1m4 0h1\"/>\n          </svg>\n        </div>\n        <div>\n          <p class=\"text-sm font-medium text-gray-600\">Categorias</p>\n          <p class=\"text-2xl font-bold text-gray-900\">\n            {#if isLoading}\n              <span class=\"animate-pulse bg-gray-200 rounded w-8 h-6 inline-block\"></span>\n            {:else}\n              {stats.totalCategories}\n            {/if}\n          </p>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Total Products -->\n    <div class=\"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow\">\n      <div class=\"flex items-center\">\n        <div class=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4\">\n          <svg class=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"/>\n          </svg>\n        </div>\n        <div>\n          <p class=\"text-sm font-medium text-gray-600\">Total de Produtos</p>\n          <p class=\"text-2xl font-bold text-gray-900\">\n            {#if isLoading}\n              <span class=\"animate-pulse bg-gray-200 rounded w-8 h-6 inline-block\"></span>\n            {:else}\n              {stats.totalProducts}\n            {/if}\n          </p>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Active Products -->\n    <div class=\"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow\">\n      <div class=\"flex items-center\">\n        <div class=\"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center mr-4\">\n          <svg class=\"w-6 h-6 text-emerald-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n          </svg>\n        </div>\n        <div>\n          <p class=\"text-sm font-medium text-gray-600\">Produtos Ativos</p>\n          <p class=\"text-2xl font-bold text-gray-900\">\n            {#if isLoading}\n              <span class=\"animate-pulse bg-gray-200 rounded w-8 h-6 inline-block\"></span>\n            {:else}\n              {stats.activeProducts}\n            {/if}\n          </p>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Inactive Products -->\n    <div class=\"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow\">\n      <div class=\"flex items-center\">\n        <div class=\"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mr-4\">\n          <svg class=\"w-6 h-6 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728\"/>\n          </svg>\n        </div>\n        <div>\n          <p class=\"text-sm font-medium text-gray-600\">Produtos Inativos</p>\n          <p class=\"text-2xl font-bold text-gray-900\">\n            {#if isLoading}\n              <span class=\"animate-pulse bg-gray-200 rounded w-8 h-6 inline-block\"></span>\n            {:else}\n              {stats.inactiveProducts}\n            {/if}\n          </p>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  <!-- Error Message -->\n  {#if error}\n    <div class=\"mb-8 p-4 bg-red-50 border border-red-200 rounded-lg\">\n      <div class=\"flex items-center\">\n        <svg class=\"w-5 h-5 text-red-600 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n          <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clip-rule=\"evenodd\"/>\n        </svg>\n        <p class=\"text-red-800 font-medium\">{error}</p>\n        <button\n          onclick={loadStats}\n          class=\"ml-auto text-red-600 hover:text-red-700 text-sm font-medium\"\n        >\n          Tentar novamente\n        </button>\n      </div>\n    </div>\n  {/if}\n  \n  <!-- Quick Actions -->\n  <div class=\"grid md:grid-cols-2 gap-8\">\n    <!-- Management Cards -->\n    <div class=\"space-y-6\">\n      <h3 class=\"text-lg font-semibold text-gray-900\">Ações Rápidas</h3>\n      \n      <!-- Categories Management -->\n      <div class=\"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow\">\n        <div class=\"flex items-center justify-between\">\n          <div class=\"flex items-center\">\n            <div class=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4\">\n              <svg class=\"w-5 h-5 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14-4v8a2 2 0 01-2 2H7a2 2 0 01-2-2V7a2 2 0 012-2h10a2 2 0 012 2zM9 11h1m4 0h1\"/>\n              </svg>\n            </div>\n            <div>\n              <h4 class=\"text-lg font-medium text-gray-900\">Gerenciar Categorias</h4>\n              <p class=\"text-sm text-gray-600\">Organize o cardápio por categorias</p>\n            </div>\n          </div>\n          <a\n            href=\"/admin/categories\"\n            class=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors\"\n          >\n            Acessar\n            <svg class=\"w-4 h-4 ml-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"/>\n            </svg>\n          </a>\n        </div>\n      </div>\n      \n      <!-- Products Management -->\n      <div class=\"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow\">\n        <div class=\"flex items-center justify-between\">\n          <div class=\"flex items-center\">\n            <div class=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4\">\n              <svg class=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"/>\n              </svg>\n            </div>\n            <div>\n              <h4 class=\"text-lg font-medium text-gray-900\">Gerenciar Produtos</h4>\n              <p class=\"text-sm text-gray-600\">Adicione e edite produtos do cardápio</p>\n            </div>\n          </div>\n          <a\n            href=\"/admin/products\"\n            class=\"inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-colors\"\n          >\n            Acessar\n            <svg class=\"w-4 h-4 ml-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"/>\n            </svg>\n          </a>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Recent Activity (Placeholder) -->\n    <div>\n      <h3 class=\"text-lg font-semibold text-gray-900 mb-6\">Atividade Recente</h3>\n      <div class=\"bg-white rounded-xl p-6 shadow-sm border border-gray-200\">\n        <div class=\"text-center py-8\">\n          <svg class=\"w-12 h-12 text-gray-400 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n          </svg>\n          <p class=\"text-gray-600\">Nenhuma atividade recente</p>\n          <p class=\"text-sm text-gray-500 mt-2\">As ações realizadas aparecerão aqui</p>\n        </div>\n      </div>\n    </div>\n  </div>\n</AdminLayout>